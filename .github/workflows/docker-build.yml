name: Build and Push Docker Image
on:
  push:
    branches: [ main ] # 触发：推送到 main 分支
  release:
    types: [ published ] # 或在发布 release 时触发
jobs:
  build-and-push:
    runs-on: ubuntu-latest # 使用 Ubuntu runner
    concurrency:
      group: $$ {{ github.workflow }}- $${{ github.ref }}
      cancel-in-progress: true # 自动取消旧的运行中任务
    steps:
      - name: Checkout code
        uses: actions/checkout@v4 # 拉取仓库代码（自动，无需本地）
      - name: Set up QEMU # 支持多平台构建（可选）
        uses: docker/setup-qemu-action@v3
      - name: Set up Docker Buildx # 使用 Buildx 构建
        uses: docker/setup-buildx-action@v3
      - name: Login to Docker Hub # 登录 Docker Hub（替换为你的仓库）
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }} # GitHub Secrets 中存储
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      - name: Build and push
        uses: docker/build-push-action@v6 # 官方动作，自动构建并推送
        with:
          context: . # 构建上下文：当前目录
          push: true # 推送镜像
          tags: a377592027/openlist:latest # 镜像标签（替换为你的）
          platforms: linux/amd64,linux/arm64 # 多平台（可选）
